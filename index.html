<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´¾å…‹å…¬æœƒä»»å‹™çœ‹æ¿</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --harry: #ef4444; --zoe: #10b981; --ian: #3b82f6; --chris: #f59e0b; }
        body { background-color: #f8fafc; font-family: -apple-system, "Microsoft JhengHei", sans-serif; padding-bottom: 50px; }
        .guild-header { background: #1e293b; color: white; padding: 20px 0; margin-bottom: 25px; border-radius: 0 0 20px 20px; }
        .section-title { font-weight: 700; color: #1e293b; margin: 25px 0 15px 0; border-left: 5px solid #6366f1; padding-left: 15px; }
        
        /* å¤§å¡ç‰‡ï¼ˆæˆå“¡ï¼‰ */
        .member-column { background: #f1f5f9; border-radius: 16px; padding: 10px; height: 100%; border: 1px solid #e2e8f0; }
        .member-header { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; margin-bottom: 10px; border-radius: 12px; color: white; font-weight: 800; }
        .btn-edit { color: rgba(255,255,255,0.8); text-decoration: none; font-size: 0.8rem; border: 1px solid rgba(255,255,255,0.5); padding: 2px 8px; border-radius: 4px; }
        .btn-edit:hover { color: white; background: rgba(255,255,255,0.2); }

        /* å°å¡ç‰‡ï¼ˆä»»å‹™ï¼‰ */
        .task-card { background: white; border-radius: 10px; padding: 12px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; transition: transform 0.2s; }
        .task-card:hover { transform: scale(1.02); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .task-title { font-size: 0.95rem; font-weight: 600; color: #334155; margin-bottom: 8px; line-height: 1.4; }
        .task-meta { font-size: 0.75rem; color: #64748b; margin-bottom: 10px; display: flex; justify-content: space-between; }
        
        /* ä¸‹æ‹‰é¸å–®æ¨£å¼ */
        .status-select { font-size: 0.75rem; padding: 4px 8px; border-radius: 6px; border: 1px solid #cbd5e1; background-color: #f8fafc; width: 100%; font-weight: 600; cursor: pointer; }
        .status-waiting { border-left: 4px solid #94a3b8; }
        .status-working { border-left: 4px solid #3b82f6; color: #1d4ed8; }
        .status-finished { border-left: 4px solid #10b981; color: #047857; }

        .event-item { background: white; border-radius: 12px; padding: 15px; margin-bottom: 10px; border-left: 6px solid #1e293b; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
    </style>
</head>
<body>

    <div id="loading-overlay">
        <div class="spinner-border text-primary"></div>
        <p class="mt-3 fw-bold">æ­£åœ¨è®€å–æ´¾å…‹å…¬æœƒæ•¸æ“š...</p>
    </div>

    <div class="container-fluid guild-header text-center">
        <h2 class="mb-0">ğŸ›¡ï¸ æ´¾å…‹å…¬æœƒä»»å‹™çœ‹æ¿</h2>
    </div>

    <div class="container">
        <h4 class="section-title"><i class="fas fa-calendar-star text-danger"></i> é—œéµæ´»å‹•</h4>
        <div id="event-area" class="row g-2 mb-4"></div>

        <h4 class="section-title"><i class="fas fa-th-large text-primary"></i> ä»»å‹™çœ‹æ¿</h4>
        <div class="row g-3">
            <div class="col-12 col-md-6 col-lg-3">
                <div class="member-column">
                    <div class="member-header" style="background:var(--harry)">
                        <span>Harry</span>
                        <a href="https://docs.google.com/spreadsheets/d/1X5Xp6z39P6L9m..." target="_blank" class="btn-edit">ç·¨è¼¯è¡¨å–®</a>
                    </div>
                    <div id="tasks-harry"></div>
                </div>
            </div>
            <div class="col-12 col-md-6 col-lg-3">
                <div class="member-column">
                    <div class="member-header" style="background:var(--zoe)">
                        <span>Zoe</span>
                        <a href="#" target="_blank" class="btn-edit">ç·¨è¼¯è¡¨å–®</a>
                    </div>
                    <div id="tasks-zoe"></div>
                </div>
            </div>
            <div class="col-12 col-md-6 col-lg-3">
                <div class="member-column">
                    <div class="member-header" style="background:var(--ian)">
                        <span>Ian</span>
                        <a href="#" target="_blank" class="btn-edit">ç·¨è¼¯è¡¨å–®</a>
                    </div>
                    <div id="tasks-ian"></div>
                </div>
            </div>
            <div class="col-12 col-md-6 col-lg-3">
                <div class="member-column">
                    <div class="member-header" style="background:var(--chris)">
                        <span>Chris</span>
                        <a href="#" target="_blank" class="btn-edit">ç·¨è¼¯è¡¨å–®</a>
                    </div>
                    <div id="tasks-chris"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script>
        const URL_TASKS = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSLnU0BMgl4AFXJuTVBtdmcCvuhDbv7TJxLHGK0BQZ9pJTOxdcLQ2QU1inCjXeZKJdc9v3-y4Kfk4aS/pub?output=csv';
        const URL_EVENTS = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSLnU0BMgl4AFXJuTVBtdmcCvuhDbv7TJxLHGK0BQZ9pJTOxdcLQ2QU1inCjXeZKJdc9v3-y4Kfk4aS/pub?gid=1185871089&single=true&output=csv';

        async function init() {
            try {
                const [tasks, events] = await Promise.all([
                    fetchData(URL_TASKS),
                    fetchData(URL_EVENTS)
                ]);
                renderEvents(events);
                renderTasks(tasks);
                document.getElementById('loading-overlay').style.display = 'none';
            } catch (e) { console.error(e); }
        }

        function fetchData(url) {
            return new Promise((res, rej) => {
                Papa.parse(url, { download: true, header: true, skipEmptyLines: true, complete: r => res(r.data), error: rej });
            });
        }

        function renderEvents(data) {
            const container = document.getElementById('event-area');
            const today = new Date(); today.setHours(0,0,0,0);
            
            const filtered = data.filter(row => {
                const d = new Date(row['æ—¥æœŸ'].replace(/å¹´|æœˆ/g, '/').replace(/æ—¥/g, ''));
                return d >= today;
            }).sort((a,b) => new Date(a['æ—¥æœŸ'].replace(/å¹´|æœˆ/g, '/').replace(/æ—¥/g, '')) - new Date(b['æ—¥æœŸ'].replace(/å¹´|æœˆ/g, '/').replace(/æ—¥/g, '')));

            container.innerHTML = filtered.map(e => `
                <div class="col-12 col-md-6">
                    <div class="event-item">
                        <div><div class="fw-bold">${e['Event']}</div><small class="text-muted">${e['æ—¥æœŸ']}</small></div>
                        <span class="badge bg-dark rounded-pill">Event</span>
                    </div>
                </div>
            `).join('');
        }

        function renderTasks(data) {
            const members = ['Harry', 'Zoe', 'Ian', 'Chris'];
            members.forEach(m => {
                const container = document.getElementById(`tasks-${m.toLowerCase()}`);
                const myTasks = data.filter(row => (row['è² è²¬äºº']||'').includes(m) && !(row['å®Œæˆæ—¥æœŸ']||'').trim());
                
                container.innerHTML = myTasks.map(t => {
                    // æ ¹æ“šé€²åº¦ç™¾åˆ†æ¯”æ±ºå®šåˆå§‹ä¸‹æ‹‰ç‹€æ…‹ï¼ˆæ¨¡æ“¬ï¼‰
                    const progress = parseInt(t['é€²åº¦']) || 0;
                    let statusClass = 'status-waiting';
                    let selected = 'Waiting to start';
                    if(progress > 0 && progress < 100) { statusClass = 'status-working'; selected = 'Working'; }
                    if(progress === 100) { statusClass = 'status-finished'; selected = 'Finished'; }

                    return `
                        <div class="task-card">
                            <div class="task-meta">
                                <span class="badge bg-light text-secondary">${t['Aspect'] || 'General'}</span>
                                <span class="fw-bold text-danger">${t['Deadline'] || '--'}</span>
                            </div>
                            <div class="task-title">${t['Task']}</div>
                            <select class="status-select ${statusClass}" onchange="this.className='status-select ' + (this.value=='Working'?'status-working':(this.value=='Finished'?'status-finished':'status-waiting'))">
                                <option value="Waiting to start" ${selected=='Waiting to start'?'selected':''}>â³ Waiting to start</option>
                                <option value="Working" ${selected=='Working'?'selected':''}>ğŸš€ Working (${t['é€²åº¦']||'0%'})</option>
                                <option value="Finished" ${selected=='Finished'?'selected':''}>âœ… Finished</option>
                            </select>
                        </div>
                    `;
                }).join('') || '<p class="text-center text-muted p-4">â˜• æš«ç„¡ä»»å‹™</p>';
            });
        }

        init();
    </script>
</body>
</html>
